/*Создание базы данных "Детский садик"*/
CREATE DATABASE natavrik;

/*Открытие базы данных*/
USE natavrik;

/*1. Создание таблиц*/
CREATE TABLE `персонал`( 
`табельный номер` INT NOT NULL PRIMARY KEY, 
`ФИО работника` VARCHAR (30) NOT NULL, 
`должность`VARCHAR (20) NOT NULL, 
`оклад` INT NOT NULL ); 

CREATE TABLE `группы` ( 
`номер группы` CHAR(1) NOT NULL PRIMARY KEY, 
`назвние группы` VARCHAR(20) NOT NULL, 
`табельный номер` INT NOT NULL, 

FOREIGN KEY (`табельный номер`) REFERENCES `персонал` (`табельный номер`) ON UPDATE CASCADE ON DELETE RESTRICT ); 

CREATE TABLE `Дети` ( 
`номер порядковый`INT NOT NULL PRIMARY KEY, 
`ФИО ребёнка`VARCHAR (30) NOT NULL, 
`дата рождения` DATE NOT NULL, 
`номер группы`CHAR(1) NOT NULL, 
FOREIGN KEY (`номер группы`) REFERENCES `группы` (`номер группы`) ON UPDATE CASCADE ON DELETE RESTRICT ); 

CREATE TABLE `дети1` ( 
`номер порядковый`INT NOT NULL PRIMARY KEY, 
`ФИО ребёнка`VARCHAR (30) NOT NULL, 
`дата рождения` DATE NOT NULL, 
`номер группы`CHAR(1) NOT NULL, 
FOREIGN KEY (`номер группы`) REFERENCES `группы` (`номер группы`) ON UPDATE CASCADE ON DELETE RESTRICT ); 

/*2. создание индекса (по ключевым полям индексы создаются автоматически)*/ 
CREATE INDEX `группы-табельный номер` ON `группы`(`табельный номер`); 


/*3. заполение таблиц*/ 

INSERT INTO `персонал` VALUES 
(108, "Самохина В.П.", "Ст. Воспитатель", 32000), 
(110,"Фирсова М.В.","Воспитатель", 27000), 
(102, "Фролова Н.Г.", "Воспитатель", 27000), 
(107, "Самохвалова И.В.", "Воспитатель",27000), 
(120, "Фурманов Н.И.", "Зав. детским садиком", 52000); 

INSERT INTO `группы` VALUES 
("М", "Младшая",102), 
("С", "Средняя",107), 
("П", "Подготовительная",108), 
("Я", "Ясельная",110); 

INSERT INTO `Дети` VALUES 
(1001,"Иванов Алёша","2009-07-23","С"), 
(1002,"Сидорова Наташа","2008-02-27","С"), 
(1006,"Петрова Катя","2009-09-17","С"); 

INSERT INTO `дети1` VALUES 
(1003,"Петров Артём","2006-07-23","М"), 
(1004,"Фролов Антон","2008-12-31","М"), 
(1005,"Федорова Ирина","2009-09-12","П");
);

/*2. создание индекса  (по ключевым полям индексы создаются автоматически)*/
CREATE INDEX `группы-табельный номер` ON `группы`(`табельный номер`) 


/*3. заполение таблиц*/

INSERT INTO `персонал`(`табельный номер`, `ФИО работника`, `должность`, `оклад`)
VALUES (108, "Самохина В.П.", "Ст. Воспитатель", 32000),
       (110,"Фирсова М.В.","Воспитатель", 27000),
       (102, "Фролова Н.Г.", "Воспитатель", 27000),
       (107, "Самохвалова И.В.", "Воспитатель",27000),
       (120, "Фурманов Н.И.", "Зав. детским садиком",52000);

INSERT INTO `группы` (`номер группы`, `название группы`, `табельный номер`),
VALUES ("М", "Младшая",102),
       ("С", "Средняя",107),
       ("П", "Подготовительная",108),
       ("Я", "Ясельная",110);

INSERT INTO `дети` (`номер порядковый`, `ФИО ребёнка`, `дата рождения`, `номер группы`),
VALUES (1001,"Иванов Алёша","2009-07-23","С"),
       (1002,"Сидорова Наташа","2008-02-27","С"),
       (1006,"Петрова Катя","2009-09-17","С");

INSERT INTO `дети1` (`номер порядковый`, `ФИО ребёнка`, `дата рождения`, `номер группы`),
VALUES (1003,"Петров Артём","2006-07-23","М"),
       (1004,"Фролов Антон","2008-12-31","М"),
       (1005,"Федорова Ирина","2009-09-12","П");


/*4. Копирование данных из таблицы дети1 в таблицу дети*/
INSERT INTO `дети`(`номер порядковый`,`ФИО ребёнка`,`дата рождения`,`номер группы`)
SELECT `номер порядковый`,`ФИО ребёнка`,`дата рождения`,`номер группы`FROM `дети1`;

/*5. удаление таблицы дети1*/
DROP TABLE IF EXISTS `дети1`;

/*6. Увеличение оклада на 10%*/
UPDATE `персонал` SET `оклад`=1.1*`оклад`;

/*7. удалить данных по группе "Ясельная" из всех таблиц(каскадом)*/
DELETE FROM `группы` WHERE `номер группы`="Я";


/*запросы*/

/*8. вывести на экран записи, содержащие следующие поля: табельный номер, ФИО работника, должность для всех работников, которые являются воспитателями (ст воспитателями)*/
SELECT `табельный номер`, `ФИО работника`, `должность` FROM `персонал` WHERE `номер группы`="Я";

/*9. после ввода в диалоговом окне номер группы, вывести на экран записи, содержащие следующие поля: 
номер группы, 
название группы, 
табельный номер,
 Фио сотрудника в этой группе,
 номер порядковые и
 ФИО детей из этой группы*/

SELECT B.`номер группы`,`название группы`, B.`табельный номер`, `ФИО работника`, `номер порядковый`, `ФИО  ребёнка`
FROM `дети`AS A INNER JOIN (`группы` AS B INNER JOIN `персонал`AS C ON B.`табельный номер`=C.`табельный номер`) ON A.`номер группы`=B.`номер группы` WHERE B.`номер группы`="C";
 
/*10. вывести на экран записи, содержащие следующие поля:
табельный номер,
Фио работника,
должность для всех работников. котрые не имеют групп
*/
SELECT `табельный номер`,`ФИО работника`,`должность`
FROM `персонал` AS A
WHERE (SELECT * FROM `группы` WHERE `табельный номер`=A.`табельный номер`);

/*11. вывести на экран записи, содержащие следующие поля:
табельный номер,
ФИО работника, 
кол-во детей в группе, в которой они являются воспитателями, если это колво не меньше 3
*/
SELECT C.`табельный номер`,`ФИО работника`,`должность`, COUNT(A.`номер порядковый`)
FROM `дети` AS A INNER JOIN (`группы` AS B INNER JOIN `персонал` AS C ON B.`табельный номер`=C.`табельный номер`) ON A.`номер группы`=B.`номер группы`
GROUP BY C.`табельный номер`, `ФИО работника`, `должноть`
HAVING COUNT (A.`номер порядковый`)>=3;

/*12. вывести на экран запись - среднее кол во детей в группах
*/
SELECT COUNT (`номер порядковый`)/(SELECT COUNT(`номер группы`) FROM `группы`)  AS `среднее количество детей в группе`  FROM `дети`;


/*13. вывести на экран записи, содержащие следующие поля:
номер порядковый,
ФИО ребёнка, 
его номер группы,
кол во детей в этой группе. 
*/
SELECT A.`номер порядковый`,A.`ФИО ребёнка`,A.`номер группы`,COOUNT (B.`номер порядковый`)
FROM `дети` AS A INNER JOIN `дети` AS B ON A.`номер группы`=B.`номер группы`
GROUP BY A.`номер порядковый`,A.`ФИО ребёнка`,A.`номер группы`;

/*14. вывести на экран запись, содержащуюю следующие поля:
табельный номер, 
ФИО работника,
название группы для групп, количесво детей в которых больше среднего кол ва детей в группах детского сада.
*/
SELECT C.`табельный номер`, `ФИО работника`, `название группы`
FROM `дети` AS A INNER JOIN (`группы` AS B INNE JOIN `персонал` AS C ON B.`табельный номер`=C.`табельный номер`) ON A.`номер группы`=B.`номер группы`
GROUP BY C.`табельный номер`,`ФИО работника`,`название группы`
HAVING COUNT (A.`номер порядковый`)>=(SELECT COUNT(`номер порядковый`)/(SELECT COUNT(`номер группы`) FROM `группы`) FROM `дети`);




































